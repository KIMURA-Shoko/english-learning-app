# CEFR A1/A2→B1 学習問題アプリ 要件定義（改訂版）

- 改訂日: 2026-02-22（実装反映更新）
- 対象ディレクトリ: `E:\project\english-learning-app`
- 基本方針: APIキー連携を使わず、Codexで問題を事前に大量生成して問題バンク化する

## 1. 背景と目的
初級学習者（A1・A2）が、段階的にB1レベルへ到達するための演習アプリを構築する。
運用は「実行時生成」ではなく、**事前生成済みの問題セットを配信する方式**とする。

## 2. 対象レベルと学習設計
### 2.1 レベル
- A1（導入）
- A2（基礎定着）
- B1（到達目標）

### 2.2 難易度設計
- Step 1: A1中心（短文・基本語彙・基本文型）
- Step 2: A2中心（時制・助動詞・比較・前置詞運用）
- Step 3: B1導入（関係詞、受動態、現在完了、接続表現）

### 2.3 出題比率（初期案）
- A1: 35%
- A2: 45%
- B1: 20%

## 3. スコープ
### 3.1 対象
- Webフロントエンド（PC/モバイル対応）
- 事前生成問題バンク（JSON/Markdown管理）
- 学習ログ保存（ローカルまたは簡易DB）
- 管理者レビュー機能（公開/非公開）

### 3.2 非対象
- 外部LLM APIを使ったリアルタイム生成
- TOEIC形式への最適化
- 音声合成エンジン自体の開発

## 4. 生成・運用方式（重要）
- `OPENAI_APIKEY` を含む外部APIキーは使用しない。
- 問題はこの作業環境でCodexにより事前生成し、ファイルとして保存する。
- リリース時は生成済み問題のみを配信する。
- 問題追加は「定期バッチ的に人手で追加生成 → レビュー → 反映」で運用する。

## 5. システム構成（高レベル）
- Frontend:
  - 問題表示
  - 回答入力
  - 採点・解説表示
  - 復習モード
- Content Layer:
  - `data/problems/*.json`（問題バンク）
  - `data/metadata/*.json`（タグ、レベル、文法分類）
- Admin Layer（最小）:
  - 問題のレビュー状態変更（draft/published/archived）

## 6. 機能要件
### 6.1 問題バンク
- 各問題は以下を必須とする:
  - problem_id
  - cefr_level（A1/A2/B1）
  - skill_type（grammar / reading / vocabulary）
  - question_text
  - choices（4択）
  - answer
  - explanation_ja
  - key_phrase
  - status（draft/published）

### 6.2 学習機能
- 学習者はレベル別に問題を開始できること。
- 学習者は出題モード（通常 / 誤答のみ）を選択できること。
- 1問回答ごとに正誤と日本語解説を表示すること。
- 不正解の問題は誤答ストックに自動追加されること。
- 誤答ストックのみを再出題できること。
- 問題ごとに誤答ログ（誤答回数・最終誤答日時・履歴）を保持すること。
- 誤答ストック中の問題は、連続3回正解で自動的に誤答ストックから削除されること。
- 誤答ストックおよび誤答ログを手動で全削除できること。
- 進捗として「レベル別正答率」を表示できること。

### 6.3 管理機能
- 事前生成した問題を一覧確認できること。
- 公開前に手動レビューできること。
- 問題の重複・不自然表現を修正して再公開できること。

## 7. 品質要件
### 7.1 レベル整合
- A1: 1文あたり語数の目安 6-12語
- A2: 1文あたり語数の目安 10-18語
- B1: 1文あたり語数の目安 14-24語
- 文法難易度がCEFR帯から逸脱しないこと。

### 7.2 正答品質
- 正答と解説の整合率 98%以上（レビュー時）
- 選択肢の明確な誤り/曖昧性を最小化すること。

### 7.3 重複抑制
- 類似問題の重複率を10%未満に保つこと。
- 同一語彙・同一構文の連続出題を避けること。

## 8. 非機能要件
- 可用性: 静的配信中心のため高可用な構成を優先
- 性能: 問題取得〜表示を2秒以内（通常回線）
- セキュリティ:
  - APIキー保管は不要
  - 個人情報を最小限にする
- 保守性:
  - 問題データをレベル別ファイルで分離
  - 問題ID規則を統一（例: A1_G_0001）

## 9. データ要件（最小）
### 9.1 問題データ
- `problem_id, cefr_level, skill_type, question_text, choices_json, answer, explanation_ja, key_phrase, status, created_at`

### 9.2 学習ログ
- `log_id, user_id(or local_id), problem_id, selected_answer, is_correct, answered_at`

### 9.3 進捗サマリ
- `user_id(or local_id), level, total_answered, correct_count, accuracy`

### 9.4 ローカル保存（ブラウザ）
- `cefr_wrong_problem_ids_v1`: 誤答ストック問題ID配列
- `cefr_wrong_logs_v1`: 問題IDごとの誤答ログ
  - `wrong_count`: 累計誤答回数
  - `last_wrong_at`: 最終誤答日時（ISO 8601）
  - `wrong_history`: 誤答日時履歴（ISO 8601配列）
  - `recovery_correct_streak`: 誤答ストック解除用の連続正解数

## 10. 受け入れ基準（初期）
- 公開問題数:
  - A1: 200問以上
  - A2: 300問以上
  - B1: 200問以上
- 正答率表示機能がレベル別に動作すること。
- 誤答復習モードが動作すること。
- 誤答ログ（回数・最終誤答日時）が問題単位で表示されること。
- 誤答ストック問題が3回連続正解で自動解除されること。
- 管理者レビューを通過した問題のみ公開されること。

## 11. 開発フェーズ
1. Phase 1（MVP）: A1/A2の文法4択、問題バンク読み込み、即時採点
2. Phase 2: B1問題追加、復習モード、進捗表示
3. Phase 3: 問題品質改善ループ（重複排除・難易度再調整）

## 12. リスクと対策
- リスク: 生成問題の品質ばらつき
  - 対策: 生成テンプレート固定 + 人手レビュー + 修正履歴管理
- リスク: 問題不足
  - 対策: 月次で追加生成バッチを実施
- リスク: レベル判定の主観差
  - 対策: CEFR判定基準をチェックリスト化してレビュー運用

## 13. 次工程
- 次に以下を作成する:
  - 問題生成テンプレート（A1/A2/B1別）
  - レビュー用チェックリスト
  - 問題セットの段階的増量（A1→A2→B1）
  - 進捗可視化の拡張（セッション履歴、誤答推移）

